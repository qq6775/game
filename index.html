<!DOCTYPE html>
<html>
<head>
    <title>循环陷阱大挑战 - C语言三种循环深度训练</title>
    <style>
        body {
            font-family: 'Consolas', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .game-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .scene {
            border: 2px solid #00ff00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 0 10px #00ff00;
        }
        pre {
            background: #003300;
            padding: 15px;
            border-left: 3px solid #00ff00;
            overflow-x: auto;
            color: #00ff00;
            font-size: 16px;
            line-height: 1.4;
        }
        .choice {
            cursor: pointer;
            padding: 10px;
            margin: 5px;
            border: 1px solid #00ff00;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .choice:hover {
            background: #004400;
            transform: translateX(5px);
        }
        .bool-choice {
            display: flex;
            gap: 20px;
        }
        .bool-btn {
            width: 100px;
            text-align: center;
        }
        .feedback {
            display: none;
            padding: 10px;
            margin: 10px 0;
            border-left: 3px solid #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }
        #progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #00ff00;
        }
        h1, h2 {
            text-shadow: 0 0 5px #00ff00;
        }
        .terminal-text {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        #start-screen {
            text-align: center;
            padding: 50px 0;
        }
        .btn {
            background: #003300;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            font-family: 'Consolas', monospace;
            font-size: 18px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #004400;
            box-shadow: 0 0 10px #00ff00;
        }
        .keyword {
            color: #ff00ff;
        }
        .string {
            color: #ffff00;
        }
        .comment {
            color: #888888;
        }
        .number {
            color: #00ffff;
        }
        #result {
            text-align: center;
            padding: 30px;
        }
        .badge {
            display: inline-block;
            margin: 20px;
            padding: 15px;
            border: 2px solid #00ff00;
            border-radius: 50%;
            width: 200px;
            height: 200px;
            line-height: 200px;
            font-size: 24px;
            animation: glow 2s infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 10px #00ff00; }
            50% { box-shadow: 0 0 20px #00ff00; }
        }
        .next-btn-container {
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="progress">能量值: ⚡<span id="score">100</span> | 关卡: <span id="level">1/12</span></div>

        <!-- 开始界面 -->
        <div id="start-screen">
            <h1>《循环陷阱大挑战》</h1>
            <h2>~ C语言三种循环深度训练 ~</h2>
            <p class="terminal-text">系统启动中... 准备进入循环训练模式...</p>
            <p>你是一名代码调试专家，需要识别并修复各种循环结构中的陷阱</p>
            <button class="btn" onclick="startGame()">开始挑战</button>
        </div>

        <!-- 关卡1：for循环基础 -->
        <div class="scene" id="scene1" style="display:none">
            <h2>🔄 第一关：for循环基础</h2>
            <p>航天飞行控制系统使用以下代码控制导航：</p>
            <pre><span class="keyword">for</span> (i = 0; i < 10; i++) {
    navigation_check();
    update_trajectory(i);
}</pre>
            <div class="question">
                <p>这段代码存在什么潜在问题？</p>
                <div class="choice" onclick="checkAnswer(1, this, 'C')">A) 循环体执行11次</div>
                <div class="choice" onclick="checkAnswer(1, this, 'C')">B) i++会导致循环无法终止</div>
                <div class="choice" onclick="checkAnswer(1, this, 'C')">C) 变量i未声明</div>
            </div>
            <div class="feedback" id="feedback1"></div>
            <div class="next-btn-container" id="next-btn1" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡2：while循环基础 -->
        <div class="scene" id="scene2" style="display:none">
            <h2>⚠️ 第二关：while循环基础</h2>
            <p>生命支持系统的氧气监控代码出现异常：</p>
            <pre><span class="keyword">int</span> oxygen = <span class="number">100</span>;
<span class="keyword">while</span> (oxygen > <span class="number">0</span>) {
    printf(<span class="string">"当前氧气水平: %d%%\n"</span>, oxygen);
}</pre>
            <div class="question">
                <p>这段代码会导致什么结果？</p>
                <div class="choice" onclick="checkAnswer(2, this, 'A')">A) 无限循环</div>
                <div class="choice" onclick="checkAnswer(2, this, 'A')">B) 打印一次后结束</div>
                <div class="choice" onclick="checkAnswer(2, this, 'A')">C) 打印100次后结束</div>
            </div>
            <div class="feedback" id="feedback2"></div>
            <div class="next-btn-container" id="next-btn2" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡3：do-while循环基础 -->
        <div class="scene" id="scene3" style="display:none">
            <h2>🔁 第三关：do-while循环基础</h2>
            <p>分析菜单交互系统代码：</p>
            <pre><span class="keyword">int</span> choice = 0;
<span class="keyword">do</span> {
    display_menu();
    scanf(<span class="string">"%d"</span>, &choice);
} <span class="keyword">while</span> (choice != 0)</pre>
            <div class="question">
                <p>与for和while循环相比，do-while循环的独特之处是什么？</p>
                <div class="choice" onclick="checkAnswer(3, this, 'B')">A) 可以在条件为假时执行</div>
                <div class="choice" onclick="checkAnswer(3, this, 'B')">B) 循环体至少执行一次</div>
                <div class="choice" onclick="checkAnswer(3, this, 'B')">C) 循环条件只能是布尔值</div>
            </div>
            <div class="feedback" id="feedback3"></div>
            <div class="next-btn-container" id="next-btn3" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡4：for循环变体 -->
        <div class="scene" id="scene4" style="display:none">
            <h2>🧩 第四关：for循环变体</h2>
            <p>检查系统扫描代码：</p>
            <pre><span class="keyword">for</span> (; condition; ) {
    scan_system();
    update_condition(&condition);
}</pre>
            <div class="question">
                <p>这个for循环的写法是否有效？</p>
                <div class="bool-choice">
                    <div class="choice bool-btn" onclick="checkAnswer(4, this, true)">✓ 有效</div>
                    <div class="choice bool-btn" onclick="checkAnswer(4, this, false)">× 无效</div>
                </div>
            </div>
            <div class="feedback" id="feedback4"></div>
            <div class="next-btn-container" id="next-btn4" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡5：陷阱！分号问题 -->
        <div class="scene" id="scene5" style="display:none">
            <h2>💥 第五关：隐藏分号陷阱</h2>
            <p>引擎测试代码出现故障：</p>
            <pre><span class="keyword">for</span> (int i = 0; i < 5; i++); {
    test_engine();
    report_status(i);
}</pre>
            <div class="question">
                <p>这段代码会执行test_engine()函数多少次？</p>
                <div class="choice" onclick="checkAnswer(5, this, 'B')">A) 5次</div>
                <div class="choice" onclick="checkAnswer(5, this, 'B')">B) 1次</div>
                <div class="choice" onclick="checkAnswer(5, this, 'B')">C) 0次</div>
            </div>
            <div class="feedback" id="feedback5"></div>
            <div class="next-btn-container" id="next-btn5" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡6：do-while的分号 -->
        <div class="scene" id="scene6" style="display:none">
            <h2>📝 第六关：do-while的特殊语法</h2>
            <p>检查用户输入验证代码：</p>
            <pre><span class="keyword">int</span> input;
<span class="keyword">do</span> {
    printf(<span class="string">"输入正数: "</span>);
    scanf(<span class="string">"%d"</span>, &input);
} <span class="keyword">while</span> (input <= 0) // 注意这里</pre>
            <div class="question">
                <p>以下哪项关于do-while循环的说法是正确的？</p>
                <div class="choice" onclick="checkAnswer(6, this, 'C')">A) do-while循环不需要分号</div>
                <div class="choice" onclick="checkAnswer(6, this, 'C')">B) do-while循环分号可有可无</div>
                <div class="choice" onclick="checkAnswer(6, this, 'C')">C) do-while循环结尾必须有分号</div>
            </div>
            <div class="feedback" id="feedback6"></div>
            <div class="next-btn-container" id="next-btn6" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡7：比较与赋值 -->
        <div class="scene" id="scene7" style="display:none">
            <h2>🔍 第七关：比较与赋值陷阱</h2>
            <p>分析核心系统控制代码：</p>
            <pre><span class="keyword">int</span> status = 1;
<span class="keyword">while</span> (status = 0) {
    run_system();
    update_status(&status);
}</pre>
            <div class="question">
                <p>这段代码的run_system()函数会执行几次？</p>
                <div class="choice" onclick="checkAnswer(7, this, 'A')">A) 0次</div>
                <div class="choice" onclick="checkAnswer(7, this, 'A')">B) 1次</div>
                <div class="choice" onclick="checkAnswer(7, this, 'A')">C) 无限次</div>
            </div>
            <div class="feedback" id="feedback7"></div>
            <div class="next-btn-container" id="next-btn7" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡8：循环中的break -->
        <div class="scene" id="scene8" style="display:none">
            <h2>⛔ 第八关：break的作用</h2>
            <p>分析数据处理代码：</p>
            <pre><span class="keyword">for</span> (<span class="keyword">int</span> i = 0; i < 100; i++) {
    <span class="keyword">if</span> (process_data(i) == ERROR_CODE) {
        <span class="keyword">break</span>;
    }
    log_progress(i);
}</pre>
            <div class="question">
                <p>如果process_data(5)返回ERROR_CODE，循环会如何执行？</p>
                <div class="choice" onclick="checkAnswer(8, this, 'C')">A) 继续执行到i=99</div>
                <div class="choice" onclick="checkAnswer(8, this, 'C')">B) 跳过当前迭代继续下一次</div>
                <div class="choice" onclick="checkAnswer(8, this, 'C')">C) 立即终止整个循环</div>
            </div>
            <div class="feedback" id="feedback8"></div>
            <div class="next-btn-container" id="next-btn8" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡9：循环中的continue -->
        <div class="scene" id="scene9" style="display:none">
            <h2>⏩ 第九关：continue的作用</h2>
            <p>分析传感器数据处理代码：</p>
            <pre><span class="keyword">int</span> i = 0;
<span class="keyword">while</span> (i < 10) {
    i++;
    <span class="keyword">if</span> (i % 2 == 0) {
        <span class="keyword">continue</span>;
    }
    process_sensor(i);
}</pre>
            <div class="question">
                <p>process_sensor函数会处理哪些值？</p>
                <div class="choice" onclick="checkAnswer(9, this, 'B')">A) 0,2,4,6,8</div>
                <div class="choice" onclick="checkAnswer(9, this, 'B')">B) 1,3,5,7,9</div>
                <div class="choice" onclick="checkAnswer(9, this, 'B')">C) 所有从0到9的数</div>
            </div>
            <div class="feedback" id="feedback9"></div>
            <div class="next-btn-container" id="next-btn9" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡10：嵌套循环 -->
        <div class="scene" id="scene10" style="display:none">
            <h2>🌀 第十关：嵌套循环</h2>
            <p>分析地图扫描系统代码：</p>
            <pre><span class="keyword">for</span> (<span class="keyword">int</span> x = 0; x < 3; x++) {
    <span class="keyword">for</span> (<span class="keyword">int</span> y = 0; y < 3; y++) {
        <span class="keyword">if</span> (x == 1 && y == 1) {
            <span class="keyword">break</span>;
        }
        scan_location(x, y);
    }
}</pre>
            <div class="question">
                <p>scan_location函数总共会被调用多少次？</p>
                <div class="choice" onclick="checkAnswer(10, this, 'B')">A) 9次</div>
                <div class="choice" onclick="checkAnswer(10, this, 'B')">B) 8次</div>
                <div class="choice" onclick="checkAnswer(10, this, 'B')">C) 7次</div>
            </div>
            <div class="feedback" id="feedback10"></div>
            <div class="next-btn-container" id="next-btn10" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡11：三种循环比较 -->
        <div class="scene" id="scene11" style="display:none">
            <h2>⚖️ 第十一关：三种循环比较</h2>
            <p>比较三种不同循环的实现：</p>
            <pre><span class="comment">// 实现1: for循环</span>
<span class="keyword">for</span> (<span class="keyword">int</span> i = 0; i < n; i++) {
    process(i);
}

<span class="comment">// 实现2: while循环</span>
<span class="keyword">int</span> i = 0;
<span class="keyword">while</span> (i < n) {
    process(i);
    i++;
}

<span class="comment">// 实现3: do-while循环</span>
<span class="keyword">int</span> i = 0;
<span class="keyword">do</span> {
    process(i);
    i++;
} <span class="keyword">while</span> (i < n);</pre>
            <div class="question">
                <p>如果n=0，以上哪种实现会执行process()函数？</p>
                <div class="choice" onclick="checkAnswer(11, this, 'C')">A) 实现1和实现2</div>
                <div class="choice" onclick="checkAnswer(11, this, 'C')">B) 所有实现都不会执行</div>
                <div class="choice" onclick="checkAnswer(11, this, 'C')">C) 只有实现3会执行</div>
            </div>
            <div class="feedback" id="feedback11"></div>
            <div class="next-btn-container" id="next-btn11" style="display:none;">
                <button class="btn" onclick="nextLevel()">进入下一关</button>
            </div>
        </div>

        <!-- 关卡12：综合挑战 -->
        <div class="scene" id="scene12" style="display:none">
            <h2>🏆 第十二关：终极挑战</h2>
            <p>修复主控系统中的循环错误：</p>
            <pre><span class="keyword">int</span> i = 10;

<span class="comment">// 循环1</span>
<span class="keyword">for</span> (i = 0; i < 5; i++);
{
    printf(<span class="string">"A:%d "</span>, i);
}

<span class="comment">// 循环2</span>
<span class="keyword">while</span> (i = 5) {
    printf(<span class="string">"B:%d "</span>, i);
    i++;
}

<span class="comment">// 循环3</span>
<span class="keyword">do</span> {
    printf(<span class="string">"C:%d "</span>, i);
    i--;
} <span class="keyword">while</span> (i > 5)</pre>
            <div class="question">
                <p>这段代码的输出会是什么？</p>
                <div class="choice" onclick="checkAnswer(12, this, 'A')">A) A:5 B:5 B:6 B:7... (无限循环)</div>
                <div class="choice" onclick="checkAnswer(12, this, 'A')">B) A:0 A:1 A:2 A:3 A:4 B:5 C:5 C:4</div>
                <div class="choice" onclick="checkAnswer(12, this, 'A')">C) 代码无法编译</div>
            </div>
            <div class="feedback" id="feedback12"></div>
            <div class="next-btn-container" id="next-btn12" style="display:none;">
                <button class="btn" onclick="showResult()">查看结果</button>
            </div>
        </div>

        <!-- 结果页 -->
        <div id="result" style="display:none">
            <h2>🎉 恭喜完成训练！</h2>
            <div class="badge">循环掌控大师</div>
            <p>你的最终能量值: <span id="final-score">0</span></p>
            <p id="master-comment"></p>
            <button class="btn" onclick="restart()">再次挑战</button>
        </div>
    </div>

    <script>
        // 全局变量
        let currentLevel = 1;
        let score = 100;
        let totalLevels = 12;

        // 开始游戏
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('scene1').style.display = 'block';
        }

        // 检查答案
        function checkAnswer(level, element, correct) {
            const feedback = document.getElementById(`feedback${level}`);
            const nextBtn = document.getElementById(`next-btn${level}`);
            let isCorrect = false;

            // 禁用所有选项
            document.querySelectorAll(`#scene${level} .choice`).forEach(choice => {
                choice.style.pointerEvents = 'none';
            });

            // 判断题型
            if (typeof correct === 'boolean') { // 判断题
                const userChoice = element.textContent.includes('✓');
                isCorrect = (userChoice === correct);
            } else { // 选择题
                isCorrect = element.textContent.startsWith(correct);
            }

            // 高亮选中选项
            if (isCorrect) {
                element.style.backgroundColor = '#004400';
                element.style.borderColor = '#00ff00';
                element.style.boxShadow = '0 0 10px #00ff00';
            } else {
                element.style.backgroundColor = '#440000';
                element.style.borderColor = '#ff0000';
            }

            // 显示反馈
            feedback.style.display = 'block';
            feedback.innerHTML = isCorrect ? 
                `<p>✅ <strong>正确！</strong></p><p>${getExplanation(level)}</p>` : 
                `<p>❌ <strong>错误！</strong></p><p>${getExplanation(level)}</p>`;

            // 更新分数
            score += isCorrect ? 10 : -15;
            document.getElementById('score').textContent = Math.max(0, score);

            // 显示下一关按钮
            nextBtn.style.display = 'block';
        }

        // 进入下一关
        function nextLevel() {
            document.getElementById(`scene${currentLevel}`).style.display = 'none';
            currentLevel++;
            document.getElementById(`scene${currentLevel}`).style.display = 'block';
            document.getElementById('level').textContent = `${currentLevel}/${totalLevels}`;
        }

        // 获取解释
        function getExplanation(level) {
            const explanations = {
                1: "变量i在使用前没有声明类型（如int i）。在C语言中，使用未声明的变量可能导致编译错误或不可预测的行为。正确写法应该是'for (int i = 0; i < 10; i++)'。",
                2: "循环内部没有更新oxygen变量的值，所以条件永远为真，导致无限循环。应该添加'oxygen--'或类似代码来更新变量值。", 
                3: "do-while循环是唯一保证循环体至少执行一次的循环结构，因为它先执行循环体，然后才检查条件。这使它特别适合需要至少执行一次操作的场景，如菜单显示。",
                4: "for循环的三个表达式都是可选的。这个循环省略了初始化和迭代表达式，但依然是有效的C语言代码。省略表达式时，分号不能省略。这种写法在某些场景下很有用。",
                5: "for循环后面有一个分号，这导致循环体为空。循环结束后，大括号内的代码作为单独的代码块执行，与循环无关。因此test_engine()只会执行一次。此外，在代码块中使用i可能导致错误，因为i的作用域可能已结束。",
                6: "do-while循环在while条件后必须有分号，这是C语言语法规则。这与其他循环结构不同，是do-while的独特特征。忘记这个分号会导致编译错误。",
                7: "循环条件中使用了赋值运算符(=)而非比较运算符(==)。表达式'status = 0'将status赋值为0，而在C语言中，0作为条件表达式结果被视为假，因此循环体一次都不会执行。",
                8: "break语句会立即终止当前循环。当process_data(5)返回ERROR_CODE时，循环会立即跳出，不再执行后续迭代，也不执行当前迭代中break后的语句。",
                9: "continue语句会跳过当前迭代的剩余代码，直接进入下一次迭代。在这段代码中，当i为偶数时，continue会跳过process_sensor(i)的调用，因此只有奇数1,3,5,7,9会被处理。",
                10: "当x=1且y=1时，break语句会终止内层循环，但外层循环继续执行。这意味着位置(1,1)不会被扫描，其他8个位置都会扫描，因此函数调用总次数为8次。",
                11: "当n=0时，for循环和while循环的条件初始就不满足(0<0是假)，所以它们的循环体一次都不会执行。而do-while循环会先执行一次循环体，再检查条件，所以它至少会执行一次，即使条件一开始就不满足。",
                12: "循环1因为分号导致循环体为空，执行完循环后i=5。循环2使用赋值(i=5)而非比较，每次循环都将i设为5，且5为真，导致无限循环，所以输出为'A:5 B:5 B:5 B:5...'无限循环。循环3因为前面的无限循环，永远不会执行。"
            };
            return explanations[level];
        }

        // 显示结果
        function showResult() {
            document.querySelectorAll('.scene').forEach(s => s.style.display = 'none');
            document.getElementById('result').style.display = 'block';
            document.getElementById('final-score').textContent = Math.max(0, score);
            
            // 根据分数给出评价
            const comment = document.getElementById('master-comment');
            if (score >= 160) {
                comment.textContent = "你是循环结构的绝对大师！你对C语言循环的理解已经达到专家水平。";
            } else if (score >= 120) {
                comment.textContent = "优秀的表现！你已经掌握了各种循环结构的核心概念和常见陷阱。";
            } else if (score >= 80) {
                comment.textContent = "不错的尝试！你对循环有了基本的理解，但还需要更多练习。";
            } else {
                comment.textContent = "继续努力！循环是编程中的重要概念，多加练习你会越来越好。";
            }
        }

        // 重新开始游戏
        function restart() {
            currentLevel = 1;
            score = 100;
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = `1/${totalLevels}`;
            document.getElementById('result').style.display = 'none';
            
            // 隐藏所有场景，只显示开始屏幕
            document.querySelectorAll('.scene').forEach(s => {
                s.style.display = 'none';
            });
            document.getElementById('start-screen').style.display = 'block';
            
            // 重置所有反馈和下一关按钮
            document.querySelectorAll('.feedback').forEach(f => {
                f.style.display = 'none';
            });
            document.querySelectorAll('.next-btn-container').forEach(n => {
                n.style.display = 'none';
            });
            
            // 重置所有选项的样式和可点击状态
            document.querySelectorAll('.choice').forEach(c => {
                c.style.pointerEvents = 'auto';
                c.style.backgroundColor = '';
                c.style.borderColor = '#00ff00';
                c.style.boxShadow = 'none';
            });
        }
    </script>
</body>
</html>